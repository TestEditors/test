<html>
<style>
img {
    max-width: 100%;
    max-height: 140vh;
    height: auto;
}
body, html {
  margin: 0;
  overflow: hidden;
  height:100%;
}

@media (min-width: 768px){
  #left {
    position: absolute;
    top: 0px;
    bottom: 0;
    left: 0;
    width: 50%;
    overflow-y: scroll; 
  }
  
  #right {
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    overflow-y: scroll;
    width: 50%;
  }
}

#left {
  height:100%;
}

#right {
  height:100%;
}
</style>
<script src="tinymce/js/tinymce/tinymce.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/oauth-io/0.6.2/oauth.min.js'></script>
<script src="GitHub.bundle.js"></script>
<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
<script>
    OAuth.initialize('VnRodo6ycABEgsuWx0LF7BBgO-I');
    var provider = 'github';
    var repo = null;

    OAuth.popup(provider)
    .done(function(result) {
        console.log(result.access_token);
        var gh = new GitHub({
            token: result.access_token
        });
        repo = gh.getRepo('tguinard', 'test');
        tinymce.init({ 
            selector:'textarea', 
            plugins: "autoresize textcolor",
            toolbar: "forecolor",
            menubar: false,
            force_br_newlines : true,
            init_instance_callback: function() {
                $('#page').change(newPage);
                newPage();
            }
        });
    })
    .fail(function (err) {
        console.error(err);
    });

    function saveme() {
        if (repo) {
            var page = $('#page').val();
            var content = (tinyMCE.activeEditor.getContent({ format: "raw" }));
            repo.writeFile('master', 'htmls/' + page + '.txt', content, 'Save via editor interface', {}, function(error, result, request){
                console.log('done with the commit');
                console.log(error);
                console.log(result);
                console.log(request);
            });
        }
    }

    function newPage() {
        var page = $('#page').val();
        document.getElementById('book-image').src = ('pngs/' + page + '.png');
        repo.getContents('master', 'htmls/' + page + '.txt', false, function(error, result, request){
            var content = result.content || 'no content';
            var activeEditor = tinyMCE.activeEditor;
            activeEditor.setContent((atob(content)));
        });
    }

    function htmlEncode(value){
        return $('<div/>').text(value).html();
    }

    function htmlDecode(value){
        return $('<div/>').html(value).text();
    }

</script>
<body>
    <div class="row">
    <div class="col-md-6" style="heigh:100%" id='left'>
        <label>Page </label>
        <input type="number" id="page" min="1" max="176" step="1" value="1">
        <label> Changing the page will reset edits!</label>
        <br/>
        <input onclick='responsiveVoice.speak(tinyMCE.activeEditor.getContent({ format: "text" }));' type='button' value='Read out loud' />
        <input onclick='responsiveVoice.cancel();' type='button' value='Stop' />
        <br/>
        <input onclick='saveme()' id='save' type='button' value='Save' />
        <textarea class='my-mce-container' id='ocr-text'>
        </textarea>
    </div>
    <div class="col-md-6" id='right'>
        <img id='book-image' alt="Image of book page">
    </div>
    </div>
</body>
</html>
