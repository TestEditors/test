<html>
<style>
img {
    max-width: 100%;
    max-height: 140vh;
    height: auto;
}
body, html {
  margin: 0;
  overflow: hidden;
  height:100%;
}

@media (min-width: 768px){
  #left {
    position: absolute;
    top: 0px;
    bottom: 0;
    left: 0;
    width: 50%;
    overflow-y: scroll; 
  }
  
  #right {
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    overflow-y: scroll;
    width: 50%;
  }
}

#left {
  height:100%;
}

#right {
  height:100%;
}
</style>
<script src="tinymce/js/tinymce/tinymce.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/oauth-io/0.6.2/oauth.min.js'></script>
<script src="https://unpkg.com/github-api/dist/GitHub.bundle.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
<body>
    <div class="row">
    <div class="col-md-6" style="heigh:100%" id='left'>
        <label>Page </label>
        <input type="number" id="page" min="1" max="176" step="1" value="1">
        <label> Changing the page will reset edits!</label>
        <br/>
        <input onclick='responsiveVoice.speak(tinyMCE.activeEditor.getContent({ format: "text" }));' type='button' value='Read out loud' />
        <textarea class='my-mce-container' id='ocr-text'>
        </textarea>
    </div>
    <div class="col-md-6" id='right'>
        <img id='book-image' alt="Image of book page">
    </div>
    </div>
</body>
<script>
    OAuth.initialize('VnRodo6ycABEgsuWx0LF7BBgO-I');
    var provider = 'github';
    var repo = null;

    OAuth.popup(provider)
    .done(function(result) {
        console.log(result.access_token);
        var gh = new GitHub({
            token: result.access_token;
        });
        repo = gh.getRepo('tguinard', 'test');
        save();
    })
    .fail(function (err) {
        console.error(err);
    });
    function save() {
        if (repo) {
            repo.writeFile('master', 'hello.txt', 'saluton mondon', 'trying to use github api 2', {});
        }
    }
//repo.getContents('master', 'hello.txt', false, function(error, result, request){console.log(atob(result.content));});

    function newPage() {
        var activeEditor = tinyMCE.get('ocr-text');
        var xhr = new XMLHttpRequest();
        var page = $('#page').val();
        document.getElementById('book-image').src = ('pngs/' + page + '.png');
        xhr.open('GET', 'htmls/' + page + '.html', true);
        xhr.onreadystatechange= function() {
            var content = '';
            if (this.readyState!==4) {
                content = 'Error loading data: ready state is not 4';
            }
            else if (this.status!==200) {
                content = 'Error loading data: http status is not 200';
            }
            else {
                content = this.responseText;
            }
            activeEditor.setContent(content);
        };
        xhr.send();
    }

    tinymce.init({ 
        selector:'textarea', 
        plugins: "autoresize",
        init_instance_callback: function() {
            $('#page').change(newPage);
            newPage();
        }
    });
</script>
</html>
